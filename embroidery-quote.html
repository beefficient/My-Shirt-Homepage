<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Shirt Printing — Embroidery Quote</title>

  <!-- Fonts (MATCH index.html) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --surface:#ffffff;
      --bg:#f6faf7;
      --border:#d8e5db;
      --text:#173028;
      --muted:#456057;
      --accent:#2f7a5a;
      --accent2:#e8f6ee;
      --danger:#a63a3a;
      --container:1100px;

      /* Header colors (match index vibe) */
      --navText:#0b3f5b;
      --navHover:#eaf4ff;
      --navBorder:#d7e7f7;
      --shadow: 0 10px 24px rgba(10,35,45,.08);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.55;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:var(--container);margin:0 auto;padding:0 20px}

    /* =========================================================
       HEADER (MATCH index.html)
    ========================================================= */
    header{
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--navBorder);
    }
    .navwrap{
      position: relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:14px 0;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
    }
    .brand img{
      height: 42px;
      width: auto;
      object-fit: contain;
    }
    .brand .name{
      font-family: "DM Sans", Inter, sans-serif;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: .2px;
      white-space: nowrap;
      color: var(--navText);
    }

    nav{
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:center;
      flex-wrap: wrap;
    }
    nav a{
      font-size: 14px;
      color: var(--navText);
      padding: 8px 10px;
      border-radius: 10px;
      font-weight: 600;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    nav a:hover{background: var(--navHover)}
    nav a.active{
      border-bottom: 2px solid #0e4f73;
      border-radius: 0;
      padding-bottom: 6px;
    }

    /* Quote dropdown (same style as nav links) */
    details.quoteDrop{
      position: relative;
      display: inline-block;
    }
    details.quoteDrop > summary{
      list-style: none;
      cursor: pointer;
      user-select: none;
      font-size: 14px;
      color: var(--navText);
      padding: 8px 10px;
      border-radius: 10px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    details.quoteDrop > summary:hover{ background: var(--navHover); }
    details.quoteDrop > summary::-webkit-details-marker{ display:none; }

    /* active underline like index */
    details.quoteDrop.active > summary{
      border-bottom: 2px solid #0e4f73;
      border-radius: 0;
      padding-bottom: 6px;
    }

    .qMenu{
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      min-width: 240px;
      background: #fff;
      border: 1px solid var(--navBorder);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 6px;
      z-index: 200;
    }
    .qMenu a{
      display: block;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      color: var(--navText);
      white-space: nowrap;
    }
    .qMenu a:hover{ background: var(--navHover); }
    .qMenu a.activeItem{ background: var(--navHover); }

    /* Mobile menu toggle */
    .mobile-menu-btn{
      display:none;
      background:none;
      border:none;
      font-size:28px;
      cursor:pointer;
      padding:4px 8px;
      color:var(--navText);
      z-index:100;
      position:relative;
    }

    @media (max-width: 980px){
      .mobile-menu-btn{display:block}
      nav{
        display:none;
        position:absolute;
        top:100%;
        left:0;
        right:0;
        background:#fff;
        border-top:1px solid var(--border);
        flex-direction:column;
        align-items:stretch;
        padding:8px;
        box-shadow:var(--shadow);
        z-index:1000;
      }
      nav.show{display:flex}
      nav a{justify-content:center;padding:12px}
      details.quoteDrop{width:100%}
      details.quoteDrop > summary{justify-content:center;width:100%}
      .brand .name{display:none;}
    }

    /* =========================================================
       PAGE CONTENT (your existing embroidery form styles)
    ========================================================= */
    .wrap{max-width:980px;margin:22px auto 28px;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}
    .card{
      background:#fff;border:1px solid var(--border);
      border-radius:14px;padding:16px;
      box-shadow:0 8px 20px rgba(0,0,0,.04);
    }
    h1{
      margin:0 0 6px;
      font-size:22px;
      font-family:"DM Sans", Inter, sans-serif;
      font-weight:700;
    }
    p{margin:0 0 14px;color:var(--muted)}
    .subnote{margin:0 0 14px;color:var(--muted);font-weight:600}

    label{display:block;font-weight:600;margin:12px 0 6px}
    input,select,textarea{
      width:100%;
      padding:10px;border-radius:10px;border:1px solid var(--border);
      font-size:14px;background:#fff;font-family:inherit;
    }
    textarea{min-height:90px;resize:vertical}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    .choices{display:grid;gap:10px;margin-top:8px}
    .choice{
      display:flex;align-items:flex-start;gap:10px;
      padding:10px;border:1px solid var(--border);
      border-radius:12px;background:var(--accent2);
    }
    .choice input[type="checkbox"]{width:auto;margin-top:2px}
    .meta{flex:1}
    .inline{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap}

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background:#fff;font-size:13px;color:var(--muted);
    }
    .pill input{
      width:120px;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:13px;
      background:#fff;
    }

    .smallCheck{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background:#fff;font-size:13px;color:var(--muted);
    }
    .smallCheck input{width:auto;margin:0}

    .btn{
      margin-top:14px;width:100%;
      padding:12px 14px;border:none;border-radius:12px;
      background:var(--accent);color:#fff;font-weight:800;cursor:pointer;font-size:15px;
      font-family: inherit;
    }

    .error{color:var(--danger);font-weight:600;margin-top:10px;white-space:pre-line}

    .summary{
      background:#eaf7ef;border:1px solid #bfe2cc;border-radius:14px;padding:14px;
    }
    .emptyBox{
      border:1px dashed rgba(0,0,0,.2);
      border-radius:12px;
      padding:12px;
      color:var(--muted);
      background:#fff;
    }
    .note{
      margin-top:10px;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: var(--accent2);
      color: var(--muted);
      white-space:pre-line;
    }
    .fineprint{margin-top:8px;font-size:13px;color:var(--muted)}
    .inlineCheck{
      display:flex;gap:10px;align-items:flex-start;margin-top:12px;
      padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff;
    }
    .inlineCheck input{width:auto;margin-top:2px}
    .fileCount{margin-top:8px;font-size:13px;color:var(--accent);font-weight:600}

    /* Garment supply box (ALWAYS visible now + updated wording) */
    .garmentBox{
      margin-top:12px;
      background:#fff8e9;
      border:1px solid #f0d8b0;
      border-radius:12px;
      padding:12px;
      display:flex;              /* was: none */
      flex-direction:column;
      gap:12px;
    }
    .garmentBox .topMsg{
      border:1px dashed rgba(0,0,0,.2);
      border-radius:12px;
      padding:12px;
      color:var(--muted);
      background:#fff;
      line-height:1.55;
    }
    .garmentBox .txt{
      color:var(--text);
      font-weight:900;
      font-size:22px;
      font-family:"DM Sans", Inter, sans-serif;
      margin:0;
    }
    .garmentBox .subtxt{
      color:var(--muted);
      font-weight:600;
      margin: 4px 0 0;
      max-width: 70ch;
    }
    .garmentBox .actions{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .garmentBox .linkBtn{
      background:var(--accent);
      color:#fff;
      padding:12px 18px;
      border-radius:12px;
      font-weight:900;
      text-decoration:none;
      border:1px solid transparent;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:18px;
    }
    .garmentBox .note{
      font-size:18px;
      color:var(--muted);
      margin-top:0;
      max-width:100%;
      border:none;
      background:transparent;
      padding:0;
      border-radius:0;
    }
    .garmentBox .fineNote{
      font-size:18px;
      color:var(--muted);
      margin-top:6px;
      max-width: 80ch;
    }

    /* Info boxes */
    .infoBox{
      margin-top:12px;
      background:#e8f3ff;
      border:1px solid #b3d9ff;
      border-radius:12px;
      padding:12px;
    }
    .infoBox .title{font-weight:800;margin-bottom:8px;font-size:15px;color:var(--text)}
    .infoBox .text{color:var(--muted);font-weight:500;line-height:1.6}

    /* Price match box */
    .priceMatchBox{
      margin-top:12px;
      background:#fff4e6;
      border:1px solid #ffd699;
      border-radius:12px;
      padding:12px;
    }
    .priceMatchBox .title{font-weight:800;margin-bottom:8px;font-size:15px;color:var(--text)}
    .priceMatchBox .text{color:var(--muted);font-weight:500;line-height:1.6;margin-bottom:12px}
    .priceMatchBox label{margin:8px 0 6px;font-size:14px}
    .priceMatchBox input[type="file"]{font-size:13px;padding:8px}
    .priceMatchBox .uploadNote{font-size:13px;color:var(--muted);margin-top:6px}

    @media (max-width: 860px){
      .wrap{padding:0 12px}
      .grid{grid-template-columns:1fr}
      .card{padding:14px}
      .pill input{width:110px}
      .garmentBox .txt{font-size:20px}
      .garmentBox .linkBtn{font-size:16px}
      .garmentBox .note, .garmentBox .fineNote{font-size:16px}
      .row{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
    @media (max-width: 560px){
      .brand img{height: 38px}
      .brand .name{display:none}
      h1{font-size:20px}
      .btn{font-size:14px;padding:10px 12px}
      input,select,textarea{font-size:16px;padding:12px}
    }
  </style>
</head>

<body>
  <!-- HEADER (now matches index.html) -->
  <header>
    <div class="container">
      <div class="navwrap">
        <a class="brand" href="index.html" aria-label="Go to homepage">
          <img src="logo.png" alt="My Shirt Printing logo" />
          <div class="name">My Shirt Printing and Embroidery</div>
        </a>

        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">☰</button>

        <nav id="mainNav" aria-label="Main menu">
          <a href="index.html">Home</a>

          <!-- Quote dropdown (active on quote pages) -->
          <details class="quoteDrop active" id="quoteDrop">
            <summary>Quote <span aria-hidden="true">▾</span></summary>
            <div class="qMenu" role="menu" aria-label="Quote menu">
              <a href="quote.html">Garment Printing Quote</a>
              <a class="activeItem" href="embroidery-quote.html">Embroidery Quote</a>
              <a href="other-printing.html">Other Services</a>

            </div>
          </details>

          <a href="gallery.html">Gallery</a>
          <a href="about-us.html">About Us</a>
          <a href="contact.html">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <div class="wrap">
    <h1>Embroidery Quote Request</h1>
    <p>For embroidery, we will need an estimated stitch count to provide a quote. We'll review your details and send an official quote.</p>
    <div class="subnote">Please give us up to 24 hours (business days).</div>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card">
        <div class="row">
          <div>
            <label for="custName">Name</label>
            <input id="custName" type="text" autocomplete="name" placeholder="Your name" />
          </div>
          <div>
            <label for="custEmail">Email</label>
            <input id="custEmail" type="email" autocomplete="email" placeholder="you@email.com" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="custPhone">Phone (optional)</label>
            <input id="custPhone" type="tel" autocomplete="tel" placeholder="(555) 555-5555" />
          </div>
          <div>
            <label for="qty">Quantity of garments</label>
            <input id="qty" type="number" min="1" step="1" autocomplete="off" />
          </div>
        </div>

        <label>Embroidery Locations</label>
        <div class="choices" id="locations">
          <!-- Front Center -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Front Center">
            <div class="meta">
              <strong>Front Center</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Front Center" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Front Center" inputmode="decimal" placeholder="ex: 3.5" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Front Center" inputmode="decimal" placeholder="ex: 2.0" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Front Center" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Right Chest (ADDED) -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Right Chest">
            <div class="meta">
              <strong>Right Chest</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Right Chest" placeholder="ex: 2" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Right Chest" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Right Chest" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Right Chest" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Left Chest (ADDED) -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Left Chest">
            <div class="meta">
              <strong>Left Chest</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Left Chest" placeholder="ex: 2" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Left Chest" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Left Chest" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Left Chest" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Back Center -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Back Center">
            <div class="meta">
              <strong>Back Center</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Back Center" placeholder="ex: 4" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Back Center" inputmode="decimal" placeholder="ex: 10" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Back Center" inputmode="decimal" placeholder="ex: 12" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Back Center" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Left Sleeve -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Left Sleeve">
            <div class="meta">
              <strong>Left Sleeve</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Left Sleeve" placeholder="ex: 2" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Left Sleeve" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Left Sleeve" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Left Sleeve" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Right Sleeve -->
          <div class="choice">
            <input type="checkbox" class="locCheck" data-loc="Right Sleeve">
            <div class="meta">
              <strong>Right Sleeve</strong>
              <div class="inline">
                <span class="pill">Thread colors:
                  <input class="threadColors" data-loc="Right Sleeve" placeholder="ex: 2" autocomplete="off" />
                </span>

                <span class="pill">Width (in):
                  <input class="wSize" data-loc="Right Sleeve" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="pill">Height (in):
                  <input class="hSize" data-loc="Right Sleeve" inputmode="decimal" placeholder="ex: 3" autocomplete="off" />
                </span>

                <span class="smallCheck">
                  <input type="checkbox" class="propCheck" data-loc="Right Sleeve" />
                  <span>To proportion</span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <label for="notes">Additional notes (optional)</label>
        <textarea id="notes" placeholder="Garment type, placement details, deadlines, etc."></textarea>

        <label for="artFile">Upload image (optional)</label>
        <input id="artFile" type="file" accept="image/*,.pdf,.ai,.eps,.svg" multiple />
        <div class="fineprint" id="limitText"></div>
        <div class="fileCount" id="fileCount"></div>
        <div class="error" id="fileError"></div>

        <div class="inlineCheck">
          <input id="sharingDirectly" type="checkbox">
          <label for="sharingDirectly" style="margin:0;font-weight:700">
            Sharing image directly
            <div class="muted" style="font-weight:500;margin-top:4px">
              Gmail allows a maximum attachment size of 25&nbsp;MB.
              If your file exceeds this limit, please share it via Google Drive, Dropbox,
              or a similar platform and send the link directly to
              <strong>myshirtcustomerservice@gmail.com</strong>.
            </div>
          </label>
        </div>

        <input id="website" type="text" style="display:none" tabindex="-1" autocomplete="off" />

        <button class="btn" id="submitBtn">Submit Quote Request</button>
        <div class="error" id="error"></div>
      </div>

      <!-- OUTPUT -->
      <div class="card">
        <div class="emptyBox" id="emptyState">
          After you submit, a confirmation message will appear here.
        </div>

        <div class="summary" id="successBox" style="display:none"></div>

        <!-- Garment supply box (ALWAYS visible + updated wording) -->
        <div id="garmentBox" class="garmentBox">
          <div class="topMsg">
            Your quote will appear here after you click <b>Calculate Quote</b>. You will get a separate quote for the garments by hitting quote button below. We will then combine the quotes, review everything and contact you with a final quote.
          </div>

          <div>
            <div class="txt">Would you like us to supply the garments for this order?</div>
            <div class="note">Click the button to start a garments quote.</div>
          </div>

          <div class="actions">
            <a id="garmentQuoteBtn" class="linkBtn" href="#" role="button" target="_blank" rel="noopener noreferrer">Start garments quote</a>
          </div>

          <div class="fineNote">Prices may change after review. Some items may be on sale or out of stock. All quotes will be confirmed after review.</div>
        </div>

        <!-- Estimates Notice -->
        <div class="infoBox">
          <div class="title">Quotes are ESTIMATES ONLY</div>
          <div class="text">There may be discounts that were not applied. Give us 24 hours to confirm pricing.</div>
        </div>

        <!-- Price Match Box -->
        <div class="priceMatchBox">
          <div class="title">PRICE MATCHES</div>
          <div class="text">We will beat prices if it is apples to apples. Upload your quote document here or email it to us! We will look into your quote and get back to you within 24 hours.</div>
          <label for="priceMatchFile">Upload competitor's quote</label>
          <input id="priceMatchFile" type="file" accept="image/*,.pdf,.doc,.docx" />
          <div class="fileCount" id="priceMatchFileCount"></div>
          <div class="uploadNote">You can also email quotes to <strong>myshirtcustomerservice@gmail.com</strong></div>
        </div>

      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Mobile menu toggle
  var mobileMenuBtn = document.getElementById("mobileMenuBtn");
  var mainNav = document.getElementById("mainNav");
  
  if (mobileMenuBtn && mainNav) {
    mobileMenuBtn.addEventListener("click", function(e) {
      e.stopPropagation();
      mainNav.classList.toggle("show");
    });
  }

  // Close menu and dropdown when clicking outside
  document.addEventListener("click", function(e) {
    // Close mobile menu
    if (mainNav && mobileMenuBtn) {
      if (!mainNav.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
        mainNav.classList.remove("show");
      }
    }
    
    // Close quote dropdown
    var dd = document.getElementById("quoteDrop");
    if (dd && !dd.contains(e.target)) {
      dd.removeAttribute("open");
    }
  });

  var API_ENDPOINT = "/api/send-quote";
  var ENABLE_MAILTO_FALLBACK = false;

  var GMAIL_MAX_BYTES = 25 * 1024 * 1024;

  var artFile = document.getElementById("artFile");
  var fileError = document.getElementById("fileError");
  var limitText = document.getElementById("limitText");
  var errorEl = document.getElementById("error");
  var successBox = document.getElementById("successBox");
  var emptyState = document.getElementById("emptyState");
  var sharingDirectly = document.getElementById("sharingDirectly");

  function formatBytes(bytes){
    var mb = bytes / (1024 * 1024);
    var rounded = Math.round(mb);
    var display = (Math.abs(mb - rounded) < 0.05) ? rounded.toString() : mb.toFixed(1);
    return display + " MB";
  }
  limitText.textContent = "Maximum upload size: " + formatBytes(GMAIL_MAX_BYTES) + ".";

  function showSuccess(){
    emptyState.style.display = "none";
    successBox.style.display = "block";
    successBox.innerHTML = '<div style="font-weight:900;margin-bottom:6px">Request sent</div><div class="muted" style="font-weight:600">Your request for a quote has been sent, please give us up to 24 hours to respond with a quote! Thank you!</div>';
  }

  function normalizeNum(v){
    var n = Number(String(v || "").trim());
    return Number.isFinite(n) && n > 0 ? n : null;
  }

  function validateFile(){
    fileError.textContent = "";
    var files = artFile.files;
    if(!files || files.length === 0) return true;
    
    var totalSize = 0;
    for(var i = 0; i < files.length; i++){
      totalSize += files[i].size;
    }
    
    if (totalSize > GMAIL_MAX_BYTES){
      fileError.textContent = "Your files exceed the total size limit of " + formatBytes(GMAIL_MAX_BYTES) + ".\nPlease reduce the number of files or share them via Google Drive/Dropbox (or similar) directly to myshirtcustomerservice@gmail.com.";
      return false;
    }
    return true;
  }

  function setHeightEnabled(loc, enabled){
    var h = document.querySelector('.hSize[data-loc="' + CSS.escape(loc) + '"]');
    if (!h) return;
    h.disabled = !enabled;
    if (!enabled) h.value = "";
    h.style.opacity = enabled ? "1" : ".6";
  }

  var propChecks = document.querySelectorAll(".propCheck");
  for(var i=0; i<propChecks.length; i++){
    propChecks[i].addEventListener("change", function() {
      var loc = this.dataset.loc;
      setHeightEnabled(loc, !this.checked);
    });
  }

  artFile.addEventListener("change", function() {
    var fileCountEl = document.getElementById("fileCount");
    var files = artFile.files;
    
    if(files && files.length > 0){
      var totalSize = 0;
      for(var i = 0; i < files.length; i++){
        totalSize += files[i].size;
      }
      var fileText = files.length === 1 ? "1 file" : files.length + " files";
      fileCountEl.textContent = fileText + " selected (" + formatBytes(totalSize) + " total)";
    } else {
      fileCountEl.textContent = "";
    }
    
    if (!sharingDirectly.checked) validateFile();
  });

  sharingDirectly.addEventListener("change", function() {
    if (sharingDirectly.checked) fileError.textContent = "";
    else validateFile();
  });

  // Price match file upload display
  var priceMatchFile = document.getElementById("priceMatchFile");
  var priceMatchFileCount = document.getElementById("priceMatchFileCount");

  if (priceMatchFile) {
    priceMatchFile.addEventListener("change", function() {
      if (priceMatchFileCount) {
        var files = priceMatchFile.files;
        if (files && files.length > 0) {
          priceMatchFileCount.textContent = "File selected: " + files[0].name;
        } else {
          priceMatchFileCount.textContent = "";
        }
      }
    });
  }

  function getSelectedLocations(){
    var locChecks = document.querySelectorAll(".locCheck");
    var selected = [];
    for(var i=0; i<locChecks.length; i++){
      if(locChecks[i].checked) selected.push(locChecks[i].dataset.loc);
    }

    return selected.map(function(loc) {
      var tcEl = document.querySelector('.threadColors[data-loc="' + CSS.escape(loc) + '"]');
      var wEl = document.querySelector('.wSize[data-loc="' + CSS.escape(loc) + '"]');
      var hEl = document.querySelector('.hSize[data-loc="' + CSS.escape(loc) + '"]');
      var propEl = document.querySelector('.propCheck[data-loc="' + CSS.escape(loc) + '"]');

      var tc = (tcEl ? tcEl.value : "").trim();
      var wRaw = (wEl ? wEl.value : "").trim();
      var hRaw = (hEl ? hEl.value : "").trim();
      var prop = propEl ? propEl.checked : false;

      return {
        loc: loc,
        threadColors: tc,
        width: normalizeNum(wRaw),
        height: prop ? null : normalizeNum(hRaw),
        toProportion: prop
      };
    });
  }

  function validateForm(){
    errorEl.textContent = "";

    var name = (document.getElementById("custName").value || "").trim();
    var email = (document.getElementById("custEmail").value || "").trim();
    var phone = (document.getElementById("custPhone").value || "").trim();
    var qtyRaw = (document.getElementById("qty").value || "").trim();
    var qty = Number(qtyRaw);
    var notes = (document.getElementById("notes").value || "").trim();
    var website = (document.getElementById("website").value || "").trim();

    if(!name){
      errorEl.textContent = "Please enter your name.";
      return null;
    }
    if(!email || !email.includes("@")){
      errorEl.textContent = "Please enter a valid email address.";
      return null;
    }
    if(!qtyRaw || !qty || qty <= 0){
      errorEl.textContent = "Please enter a valid quantity.";
      return null;
    }

    var locs = getSelectedLocations();
    if(locs.length === 0){
      errorEl.textContent = "Please select at least one embroidery location.";
      return null;
    }

    for(var i=0; i<locs.length; i++){
      var d = locs[i];
      if(!d.width){
        errorEl.textContent = "Please enter a width for: " + d.loc;
        return null;
      }
      if(!d.toProportion && !d.height){
        errorEl.textContent = "Please enter a height or check \"To proportion\" for: " + d.loc;
        return null;
      }
    }

    if(!sharingDirectly.checked && !validateFile()){
      errorEl.textContent = "Please fix the file issue above, or check \"Sharing image directly\".";
      return null;
    }

    return { name: name, email: email, phone: phone, qty: qty, notes: notes, website: website, locs: locs };
  }

  function buildEmbroideryEmailBody(data){
    var lines = [];
    lines.push("EMBROIDERY QUOTE REQUEST");
    lines.push("");
    lines.push("Name: " + data.name);
    lines.push("Email: " + data.email);
    if (data.phone) lines.push("Phone: " + data.phone);
    lines.push("Quantity: " + data.qty);
    lines.push("");
    lines.push("Locations:");
    for(var i=0; i<data.locs.length; i++){
      var d = data.locs[i];
      var tc = d.threadColors ? "Thread colors: " + d.threadColors : "Thread colors: (not provided)";
      var size = d.toProportion
        ? "Width: " + d.width + " in, Height: (to proportion)"
        : "Width: " + d.width + " in, Height: " + d.height + " in";
      lines.push("- " + d.loc + " | " + tc + " | " + size);
    }
    lines.push("");
    lines.push("Sharing image directly: " + (sharingDirectly.checked ? "Yes" : "No"));

    var f = artFile.files && artFile.files[0];
    if (!sharingDirectly.checked && f){
      lines.push("Uploaded file selected (note: sending file requires server upload handling): " + f.name + " (" + formatBytes(f.size) + ")");
    }

    if (data.notes){
      lines.push("");
      lines.push("Additional notes:");
      lines.push(data.notes);
    }

    lines.push("");
    lines.push("Please respond within 24 business hours with an official quote.");
    lines.push("If artwork is larger than 25MB, customer will send a Drive/Dropbox link to myshirtcustomerservice@gmail.com.");
    return lines.join("\n");
  }

  function sendToServer(payload){
    return fetch(API_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    }).then(function(res){
      return res.json().catch(function(){ return {}; }).then(function(data){
        if (!res.ok || !data.ok) throw new Error(data.message || "Server not available yet.");
        return data;
      });
    });
  }

  function mailtoFallback(subject, body){
    var to = "myshirtcustomerservice@gmail.com";
    var url = "mailto:" + encodeURIComponent(to) + "?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);
    window.location.href = url;
  }

  document.getElementById("submitBtn").addEventListener("click", function(e) {
    e.preventDefault();

    var data = validateForm();
    if(!data) return;

    var body = buildEmbroideryEmailBody(data);
    var subject = "Embroidery Quote — " + data.name + " (" + data.qty + " pcs)";

    var payload = {
      type: "embroidery",
      name: data.name,
      customerEmail: data.email,
      subject: subject,
      body: body,
      website: data.website
    };

    sendToServer(payload).then(function(){
      showSuccess();
    }).catch(function(err){
      showSuccess();
      if (ENABLE_MAILTO_FALLBACK){
        mailtoFallback(subject, body);
      }
    });
  });

  // Garment quote button opens partner site in a new window (for embroidery page)
  var garmentBtn = document.getElementById("garmentQuoteBtn");
  if (garmentBtn){
    garmentBtn.addEventListener("click", function(e){
      e.preventDefault();
      window.open("https://www.companycasuals.com/myshirtcompany//start.jsp", "_blank", "noopener,noreferrer");
    });
  }
});
</script>
</body>
</html>